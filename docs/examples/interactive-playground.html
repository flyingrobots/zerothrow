<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZeroThrow Interactive Playground</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            color: #4fc3f7;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #888;
            margin-bottom: 30px;
        }

        .playground {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .playground {
                grid-template-columns: 1fr;
            }
        }

        .editor, .output {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 20px;
        }

        h2 {
            color: #81c784;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        textarea {
            width: 100%;
            min-height: 300px;
            background: #1a1a1a;
            color: #e0e0e0;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            resize: vertical;
        }

        .controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            background: #4fc3f7;
            color: #1a1a1a;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:hover {
            background: #29b6f6;
        }

        button:active {
            transform: translateY(1px);
        }

        .example-btn {
            background: #66bb6a;
        }

        .example-btn:hover {
            background: #4caf50;
        }

        .console {
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 15px;
            min-height: 200px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .console-log {
            color: #e0e0e0;
            margin: 2px 0;
        }

        .console-error {
            color: #ef5350;
            margin: 2px 0;
        }

        .console-success {
            color: #66bb6a;
            margin: 2px 0;
        }

        .console-info {
            color: #4fc3f7;
            margin: 2px 0;
        }

        .examples {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .example-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .example-card {
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .example-card:hover {
            border-color: #4fc3f7;
            transform: translateY(-2px);
        }

        .example-card h3 {
            color: #81c784;
            margin-bottom: 5px;
            font-size: 1em;
        }

        .example-card p {
            color: #888;
            font-size: 0.9em;
        }

        .help {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 20px;
        }

        .help code {
            background: #1a1a1a;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', monospace;
            color: #4fc3f7;
        }

        .help ul {
            margin: 15px 0 15px 20px;
        }

        .help li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ZeroThrow Interactive Playground</h1>
        <p class="subtitle">Experiment with Result types and error handling in the browser</p>

        <div class="playground">
            <div class="editor">
                <h2>Code Editor</h2>
                <textarea id="code" placeholder="// Write your ZeroThrow code here..."></textarea>
                <div class="controls">
                    <button onclick="runCode()">Run Code</button>
                    <button onclick="clearConsole()">Clear Console</button>
                </div>
            </div>

            <div class="output">
                <h2>Console Output</h2>
                <div id="console" class="console"></div>
            </div>
        </div>

        <div class="examples">
            <h2>Examples</h2>
            <div class="example-grid">
                <div class="example-card" onclick="loadExample('basic')">
                    <h3>Basic Result Usage</h3>
                    <p>Creating and handling Results</p>
                </div>
                <div class="example-card" onclick="loadExample('validation')">
                    <h3>Input Validation</h3>
                    <p>Validate user input with Results</p>
                </div>
                <div class="example-card" onclick="loadExample('async')">
                    <h3>Async Operations</h3>
                    <p>Handle promises with tryR</p>
                </div>
                <div class="example-card" onclick="loadExample('chaining')">
                    <h3>Chaining Operations</h3>
                    <p>Compose with andThen and map</p>
                </div>
                <div class="example-card" onclick="loadExample('errors')">
                    <h3>Error Context</h3>
                    <p>Rich error information with ZeroError</p>
                </div>
                <div class="example-card" onclick="loadExample('recovery')">
                    <h3>Error Recovery</h3>
                    <p>Fallback strategies with orElse</p>
                </div>
            </div>
        </div>

        <div class="help">
            <h2>Available Functions</h2>
            <p>The following ZeroThrow functions are available:</p>
            <ul>
                <li><code>ok(value)</code> - Create a success Result</li>
                <li><code>err(error)</code> - Create an error Result</li>
                <li><code>tryR(fn)</code> - Convert throwing function to Result</li>
                <li><code>wrap(error, code, message, context)</code> - Create ZeroError</li>
                <li><code>andThen(result, fn)</code> - Chain operations</li>
                <li><code>map(result, fn)</code> - Transform success value</li>
                <li><code>mapErr(result, fn)</code> - Transform error value</li>
                <li><code>orElse(result, fn)</code> - Provide fallback</li>
                <li><code>unwrapOr(result, default)</code> - Extract value or default</li>
                <li><code>collect(results)</code> - Collect array of Results</li>
            </ul>
            <p>Use <code>log()</code> to output to the console.</p>
        </div>
    </div>

    <script>
        // ZeroThrow implementation (simplified for browser)
        const ZeroThrow = (() => {
            // Core types
            class ZeroError extends Error {
                constructor(code, message, cause, context) {
                    super(message);
                    this.name = 'ZeroError';
                    this.code = code;
                    this.cause = cause;
                    this.context = context || {};
                }
            }

            // Result constructors
            const ok = (value) => ({ isOk: true, isErr: false, value });
            const err = (error) => ({ isOk: false, isErr: true, error });

            // Core functions
            const tryR = async (fn, mapError) => {
                try {
                    const result = await fn();
                    return ok(result);
                } catch (error) {
                    return err(mapError ? mapError(error) : error);
                }
            };

            const wrap = (cause, code, message, context) => {
                return new ZeroError(code, message, cause, context);
            };

            // Combinators
            const andThen = (result, fn) => {
                if (result.isErr) return result;
                return fn(result.value);
            };

            const map = (result, fn) => {
                if (result.isErr) return result;
                return ok(fn(result.value));
            };

            const mapErr = (result, fn) => {
                if (result.isOk) return result;
                return err(fn(result.error));
            };

            const orElse = (result, fn) => {
                if (result.isOk) return result;
                return fn(result.error);
            };

            const unwrapOr = (result, defaultValue) => {
                return result.isOk ? result.value : defaultValue;
            };

            const collect = (results) => {
                const values = [];
                for (const result of results) {
                    if (result.isErr) return result;
                    values.push(result.value);
                }
                return ok(values);
            };

            return {
                ZeroError,
                ok,
                err,
                tryR,
                wrap,
                andThen,
                map,
                mapErr,
                orElse,
                unwrapOr,
                collect
            };
        })();

        // Console management
        const consoleEl = document.getElementById('console');
        
        function log(...args) {
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            const line = document.createElement('div');
            line.className = 'console-log';
            line.textContent = message;
            consoleEl.appendChild(line);
            consoleEl.scrollTop = consoleEl.scrollHeight;
        }

        function logError(...args) {
            const message = args.join(' ');
            const line = document.createElement('div');
            line.className = 'console-error';
            line.textContent = `Error: ${message}`;
            consoleEl.appendChild(line);
            consoleEl.scrollTop = consoleEl.scrollHeight;
        }

        function logSuccess(...args) {
            const message = args.join(' ');
            const line = document.createElement('div');
            line.className = 'console-success';
            line.textContent = `✓ ${message}`;
            consoleEl.appendChild(line);
            consoleEl.scrollTop = consoleEl.scrollHeight;
        }

        function logInfo(...args) {
            const message = args.join(' ');
            const line = document.createElement('div');
            line.className = 'console-info';
            line.textContent = `ℹ ${message}`;
            consoleEl.appendChild(line);
            consoleEl.scrollTop = consoleEl.scrollHeight;
        }

        function clearConsole() {
            consoleEl.innerHTML = '';
        }

        // Run code
        async function runCode() {
            clearConsole();
            const code = document.getElementById('code').value;
            
            if (!code.trim()) {
                logError('No code to run');
                return;
            }

            logInfo('Running code...\n');

            try {
                // Create a function with ZeroThrow functions in scope
                const AsyncFunction = Object.getPrototypeOf(async function(){}).constructor;
                const fn = new AsyncFunction(
                    'ok', 'err', 'tryR', 'wrap', 'ZeroError',
                    'andThen', 'map', 'mapErr', 'orElse', 'unwrapOr', 'collect',
                    'log', 'logError', 'logSuccess', 'logInfo',
                    code
                );

                await fn(
                    ZeroThrow.ok, ZeroThrow.err, ZeroThrow.tryR, ZeroThrow.wrap, ZeroThrow.ZeroError,
                    ZeroThrow.andThen, ZeroThrow.map, ZeroThrow.mapErr, ZeroThrow.orElse, 
                    ZeroThrow.unwrapOr, ZeroThrow.collect,
                    log, logError, logSuccess, logInfo
                );

                logSuccess('\nCode executed successfully');
            } catch (error) {
                logError(`Runtime error: ${error.message}`);
                console.error(error);
            }
        }

        // Examples
        const examples = {
            basic: `// Basic Result usage
const divide = (a, b) => {
    if (b === 0) {
        return err('Cannot divide by zero');
    }
    return ok(a / b);
};

// Test successful case
const result1 = divide(10, 2);
if (result1.isOk) {
    log('Success:', result1.value);
} else {
    log('Error:', result1.error);
}

// Test error case
const result2 = divide(10, 0);
if (result2.isOk) {
    log('Success:', result2.value);
} else {
    log('Error:', result2.error);
}`,

            validation: `// Input validation example
const validateEmail = (email) => {
    if (!email) {
        return err('Email is required');
    }
    if (!email.includes('@')) {
        return err('Invalid email format');
    }
    return ok(email.toLowerCase());
};

const validateAge = (age) => {
    const num = parseInt(age);
    if (isNaN(num)) {
        return err('Age must be a number');
    }
    if (num < 18 || num > 100) {
        return err('Age must be between 18 and 100');
    }
    return ok(num);
};

// Test validation
log('Validating email...');
const email1 = validateEmail('user@example.com');
log('Valid email:', email1);

const email2 = validateEmail('invalid-email');
log('Invalid email:', email2);

log('\\nValidating age...');
const age1 = validateAge('25');
log('Valid age:', age1);

const age2 = validateAge('fifteen');
log('Invalid age:', age2);`,

            async: `// Async operations with tryR
const fetchUser = async (id) => {
    return tryR(async () => {
        // Simulate API call
        if (id === 'invalid') {
            throw new Error('User not found');
        }
        
        // Simulate delay
        await new Promise(resolve => setTimeout(resolve, 100));
        
        return {
            id,
            name: 'John Doe',
            email: 'john@example.com'
        };
    });
};

// Test async operations
(async () => {
    log('Fetching valid user...');
    const user1 = await fetchUser('123');
    if (user1.isOk) {
        logSuccess('User found:', user1.value);
    } else {
        logError('Failed:', user1.error.message);
    }
    
    log('\\nFetching invalid user...');
    const user2 = await fetchUser('invalid');
    if (user2.isOk) {
        logSuccess('User found:', user2.value);
    } else {
        logError('Failed:', user2.error.message);
    }
})();`,

            chaining: `// Chaining operations with combinators
const parseNumber = (str) => {
    const num = parseFloat(str);
    return isNaN(num) ? err('Not a number') : ok(num);
};

const checkPositive = (num) => {
    return num > 0 ? ok(num) : err('Must be positive');
};

const calculateSquareRoot = (num) => {
    return ok(Math.sqrt(num));
};

// Chain operations
const process = (input) => {
    const parsed = parseNumber(input);
    const positive = andThen(parsed, checkPositive);
    const result = andThen(positive, calculateSquareRoot);
    return result;
};

// Test chaining
log('Processing "16"...');
const result1 = process('16');
log('Result:', result1);

log('\\nProcessing "-4"...');
const result2 = process('-4');
log('Result:', result2);

log('\\nProcessing "abc"...');
const result3 = process('abc');
log('Result:', result3);

// Using map to transform values
log('\\nUsing map to format result...');
const formatted = map(process('25'), n => \`Square root is \${n}\`);
log('Formatted:', formatted);`,

            errors: `// Rich error context with ZeroError
const processOrder = (order) => {
    if (!order.items || order.items.length === 0) {
        return err(new ZeroError(
            'EMPTY_ORDER',
            'Order must contain at least one item',
            null,
            { orderId: order.id, timestamp: new Date().toISOString() }
        ));
    }
    
    const total = order.items.reduce((sum, item) => sum + item.price, 0);
    
    if (total > order.budget) {
        return err(new ZeroError(
            'OVER_BUDGET',
            'Order exceeds budget',
            null,
            {
                orderId: order.id,
                total,
                budget: order.budget,
                difference: total - order.budget
            }
        ));
    }
    
    return ok({ ...order, total, status: 'approved' });
};

// Test with different scenarios
const order1 = { id: '001', items: [], budget: 100 };
const result1 = processOrder(order1);
log('Empty order:', result1);

const order2 = {
    id: '002',
    items: [{ name: 'Widget', price: 50 }, { name: 'Gadget', price: 75 }],
    budget: 100
};
const result2 = processOrder(order2);
log('\\nOver budget:', result2);

const order3 = {
    id: '003',
    items: [{ name: 'Widget', price: 50 }],
    budget: 100
};
const result3 = processOrder(order3);
log('\\nApproved order:', result3);`,

            recovery: `// Error recovery strategies
const primarySource = () => err('Primary source failed');
const secondarySource = () => err('Secondary source failed');
const fallbackSource = () => ok({ data: 'Fallback data', source: 'cache' });

// Try multiple sources
const getData = () => {
    log('Trying primary source...');
    const primary = primarySource();
    
    const secondary = orElse(primary, () => {
        log('Primary failed, trying secondary...');
        return secondarySource();
    });
    
    const final = orElse(secondary, () => {
        log('Secondary failed, using fallback...');
        return fallbackSource();
    });
    
    return final;
};

const result = getData();
logSuccess('Final result:', result);

// Using unwrapOr for simple defaults
log('\\nUsing unwrapOr for defaults...');
const config = err('Config not found');
const defaultConfig = { theme: 'dark', language: 'en' };
const actualConfig = unwrapOr(config, defaultConfig);
log('Config:', actualConfig);

// Collect results with error handling
log('\\nCollecting multiple results...');
const results = [
    ok(1),
    ok(2),
    err('Failed at step 3'),
    ok(4)
];

const collected = collect(results);
if (collected.isErr) {
    logError('Collection failed:', collected.error);
} else {
    logSuccess('All succeeded:', collected.value);
}

// Try again with all success
const goodResults = [ok(1), ok(2), ok(3), ok(4)];
const collected2 = collect(goodResults);
logSuccess('Successful collection:', collected2);`
        };

        // Load example
        function loadExample(name) {
            const code = examples[name];
            if (code) {
                document.getElementById('code').value = code;
                runCode();
            }
        }

        // Load basic example on start
        window.addEventListener('load', () => {
            loadExample('basic');
        });

        // Run code on Ctrl+Enter
        document.getElementById('code').addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                runCode();
            }
        });
    </script>
</body>
</html>